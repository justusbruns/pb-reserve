{"version":3,"file":"_server.ts.js","sources":["../../../../../../../src/routes/api/staticmap/+server.ts"],"sourcesContent":["import { MAPBOX_TOKEN } from '$env/static/private';\nimport { json } from '@sveltejs/kit';\nimport type { RequestHandler } from './$types';\n\nexport const GET: RequestHandler = async ({ url }) => {\n  const origin = url.searchParams.get('origin');\n  const destination = url.searchParams.get('destination');\n  const bbox = url.searchParams.get('bbox');\n  const geojson = url.searchParams.get('geojson');\n\n  if (!origin || !destination || !bbox || !geojson) {\n    return new Response('Missing required parameters', { status: 400 });\n  }\n\n  if (!MAPBOX_TOKEN) {\n    return new Response('Mapbox token not configured', { status: 500 });\n  }\n\n  try {\n    const [originLng, originLat] = origin.split(',');\n    const [destLng, destLat] = destination.split(',');\n    const timestamp = Date.now();\n\n    const mapUrl = `https://api.mapbox.com/styles/v1/mapbox/light-v11/static/geojson(${geojson}),pin-s-warehouse+326334(${originLng},${originLat}),pin-s-car+326334(${destLng},${destLat})/[${bbox}]/500x400@2x?access_token=${MAPBOX_TOKEN}&style_filter=[{\"id\":\"background\",\"color\":\"#F0F9D5\"},{\"id\":\"water\",\"color\":\"#C9DA9A\"},{\"id\":\"road\",\"color\":\"#326334\"},{\"id\":\"road-secondary-tertiary\",\"color\":\"#326334\"},{\"id\":\"road-primary\",\"color\":\"#326334\"}]&t=${timestamp}`;\n\n    // Proxy the image response\n    const response = await fetch(mapUrl);\n    \n    if (!response.ok) {\n      throw new Error(`Static map request failed: ${response.statusText}`);\n    }\n\n    const imageBuffer = await response.arrayBuffer();\n    return new Response(imageBuffer, {\n      headers: {\n        'Content-Type': 'image/png',\n        'Cache-Control': 'public, max-age=3600'\n      }\n    });\n  } catch (error) {\n    console.error('Static map service error:', error);\n    return new Response('Static map service error', { status: 500 });\n  }\n};\n"],"names":[],"mappings":";;AAIO,MAAM,MAAsB,OAAO,EAAE,UAAU;AACpD,QAAM,SAAS,IAAI,aAAa,IAAI,QAAQ;AAC5C,QAAM,cAAc,IAAI,aAAa,IAAI,aAAa;AACtD,QAAM,OAAO,IAAI,aAAa,IAAI,MAAM;AACxC,QAAM,UAAU,IAAI,aAAa,IAAI,SAAS;AAE9C,MAAI,CAAC,UAAU,CAAC,eAAe,CAAC,QAAQ,CAAC,SAAS;AAChD,WAAO,IAAI,SAAS,+BAA+B,EAAE,QAAQ,KAAK;AAAA,EAAA;AAOhE,MAAA;AACF,UAAM,CAAC,WAAW,SAAS,IAAI,OAAO,MAAM,GAAG;AAC/C,UAAM,CAAC,SAAS,OAAO,IAAI,YAAY,MAAM,GAAG;AAC1C,UAAA,YAAY,KAAK,IAAI;AAE3B,UAAM,SAAS,oEAAoE,OAAO,4BAA4B,SAAS,IAAI,SAAS,sBAAsB,OAAO,IAAI,OAAO,MAAM,IAAI,6BAA6B,YAAY,uNAAuN,SAAS;AAGjc,UAAA,WAAW,MAAM,MAAM,MAAM;AAE/B,QAAA,CAAC,SAAS,IAAI;AAChB,YAAM,IAAI,MAAM,8BAA8B,SAAS,UAAU,EAAE;AAAA,IAAA;AAG/D,UAAA,cAAc,MAAM,SAAS,YAAY;AACxC,WAAA,IAAI,SAAS,aAAa;AAAA,MAC/B,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB;AAAA,MAAA;AAAA,IACnB,CACD;AAAA,WACM,OAAO;AACN,YAAA,MAAM,6BAA6B,KAAK;AAChD,WAAO,IAAI,SAAS,4BAA4B,EAAE,QAAQ,KAAK;AAAA,EAAA;AAEnE;"}